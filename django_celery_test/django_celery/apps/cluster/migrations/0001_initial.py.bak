# -*- coding: utf-8 -*-
# Generated by Django 1.11.5 on 2017-09-27 07:29
from __future__ import unicode_literals

from django.db import migrations, models
import uuid
import time
import memcache
from ..models import SystemCluster


def create_init_system_clusters(apps, schema_editor):
    init_system_clusters = [
        SystemCluster(name='init_cluster_1',address_ip='123',
                      address_port='456'),
        SystemCluster(name='init_cluster_2', address_ip='345',
                      address_port='678'),
        SystemCluster(name='init_cluster_3', address_ip='145',
                      address_port='267'),
    ]
    client = memcache.Client([('127.0.0.1', 11211)])
    client.set("celery_server_counter", 1)
    for init_system_clusters in init_system_clusters:
        client.incr('celery_server_counter')
        time.sleep(int(client.get("celery_server_counter")))
        init_system_clusters.save()


class Migration(migrations.Migration):
    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='SystemCluster',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False,
                                        primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255, unique=True,
                                          verbose_name='name')),
                ('address_ip',
                 models.CharField(max_length=255, verbose_name='ip')),
                ('address_port',
                 models.CharField(max_length=255, verbose_name='port')),
            ],
            options={
                'db_table': 'system_cluster',
            },
        ),
        migrations.RunPython(create_init_system_clusters),

    ]
